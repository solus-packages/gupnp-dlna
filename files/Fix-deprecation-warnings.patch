From 5e7254335dc191adc8745ad51c6d34a15b126b7e Mon Sep 17 00:00:00 2001
From: Jens Georg <mail@jensge.org>
Date: Mon, 14 Jan 2019 15:05:34 +0100
Subject: [PATCH] Fix deprecation warnings regarding privates

Bump required GLib version to 2.28
---
 configure.ac                                  |  2 +-
 libgupnp-dlna/gupnp-dlna-audio-information.c  | 17 +++-----
 .../gupnp-dlna-container-information.c        | 18 +++-----
 libgupnp-dlna/gupnp-dlna-image-information.c  | 17 +++-----
 libgupnp-dlna/gupnp-dlna-information.c        | 17 +++-----
 libgupnp-dlna/gupnp-dlna-profile-guesser.c    | 17 +++-----
 libgupnp-dlna/gupnp-dlna-profile-loader.c     | 43 +++++++++----------
 libgupnp-dlna/gupnp-dlna-profile.c            | 10 ++---
 libgupnp-dlna/gupnp-dlna-video-information.c  | 17 +++-----
 .../gupnp-dlna-gst-audio-information.c        | 17 +++-----
 .../metadata/gupnp-dlna-metadata-extractor.c  | 15 +++----
 11 files changed, 72 insertions(+), 118 deletions(-)

diff --git a/configure.ac b/configure.ac
index 5b1359f..e9f47dd 100644
--- a/configure.ac
+++ b/configure.ac
@@ -170,7 +170,7 @@ GUPNP_DLNA_METADATA_BACKEND_CFLAGS="$GUPNP_DLNA_METADATA_BACKEND_CFLAGS -DGUPNP_
 
 AC_SUBST(GUPNP_DLNA_METADATA_BACKEND_CFLAGS)
 
-PKG_CHECK_MODULES([GLIB], [glib-2.0 >= 2.32])
+PKG_CHECK_MODULES([GLIB], [glib-2.0 >= 2.38])
 PKG_CHECK_MODULES([GOBJECT], [gobject-2.0])
 PKG_CHECK_MODULES([GMODULE], [gmodule-2.0])
 
diff --git a/libgupnp-dlna/gupnp-dlna-audio-information.c b/libgupnp-dlna/gupnp-dlna-audio-information.c
index ed1f121..1e646fa 100644
--- a/libgupnp-dlna/gupnp-dlna-audio-information.c
+++ b/libgupnp-dlna/gupnp-dlna-audio-information.c
@@ -47,14 +47,14 @@
 
 #include "gupnp-dlna-audio-information.h"
 
-G_DEFINE_ABSTRACT_TYPE (GUPnPDLNAAudioInformation,
-                        gupnp_dlna_audio_information,
-                        G_TYPE_OBJECT)
-
 struct _GUPnPDLNAAudioInformationPrivate {
         gpointer placeholder;
 };
 
+G_DEFINE_ABSTRACT_TYPE_WITH_PRIVATE (GUPnPDLNAAudioInformation,
+                        gupnp_dlna_audio_information,
+                        G_TYPE_OBJECT)
+
 static void
 gupnp_dlna_audio_information_class_init
                                     (GUPnPDLNAAudioInformationClass *info_class)
@@ -71,18 +71,13 @@ gupnp_dlna_audio_information_class_init
         info_class->get_stream_format = NULL;
         info_class->get_wma_version = NULL;
         info_class->get_mime = NULL;
-
-        g_type_class_add_private (info_class,
-                                  sizeof (GUPnPDLNAAudioInformationPrivate));
 }
 
 static void
 gupnp_dlna_audio_information_init (GUPnPDLNAAudioInformation *info)
 {
-        GUPnPDLNAAudioInformationPrivate *priv = G_TYPE_INSTANCE_GET_PRIVATE
-                                        (info,
-                                         GUPNP_TYPE_DLNA_AUDIO_INFORMATION,
-                                         GUPnPDLNAAudioInformationPrivate);
+        GUPnPDLNAAudioInformationPrivate *priv =
+            gupnp_dlna_audio_information_get_instance_private (info);
 
         info->priv = priv;
 }
diff --git a/libgupnp-dlna/gupnp-dlna-container-information.c b/libgupnp-dlna/gupnp-dlna-container-information.c
index f2b052b..26aaa85 100644
--- a/libgupnp-dlna/gupnp-dlna-container-information.c
+++ b/libgupnp-dlna/gupnp-dlna-container-information.c
@@ -48,14 +48,14 @@
 
 #include "gupnp-dlna-container-information.h"
 
-G_DEFINE_ABSTRACT_TYPE (GUPnPDLNAContainerInformation,
-                        gupnp_dlna_container_information,
-                        G_TYPE_OBJECT)
-
 struct _GUPnPDLNAContainerInformationPrivate {
         gpointer placeholder;
 };
 
+G_DEFINE_ABSTRACT_TYPE_WITH_PRIVATE (GUPnPDLNAContainerInformation,
+                                     gupnp_dlna_container_information,
+                                     G_TYPE_OBJECT)
+
 static void
 gupnp_dlna_container_information_class_init
                                 (GUPnPDLNAContainerInformationClass *info_class)
@@ -66,19 +66,13 @@ gupnp_dlna_container_information_class_init
         info_class->is_system_stream = NULL;
         info_class->get_variant = NULL;
         info_class->get_mime = NULL;
-
-        g_type_class_add_private
-                                (info_class,
-                                 sizeof (GUPnPDLNAContainerInformationPrivate));
 }
 
 static void
 gupnp_dlna_container_information_init (GUPnPDLNAContainerInformation *info)
 {
-        GUPnPDLNAContainerInformationPrivate *priv = G_TYPE_INSTANCE_GET_PRIVATE
-                                        (info,
-                                         GUPNP_TYPE_DLNA_CONTAINER_INFORMATION,
-                                         GUPnPDLNAContainerInformationPrivate);
+        GUPnPDLNAContainerInformationPrivate *priv = 
+            gupnp_dlna_container_information_get_instance_private (info);
 
         info->priv = priv;
 }
diff --git a/libgupnp-dlna/gupnp-dlna-image-information.c b/libgupnp-dlna/gupnp-dlna-image-information.c
index 9d23038..aa36e14 100644
--- a/libgupnp-dlna/gupnp-dlna-image-information.c
+++ b/libgupnp-dlna/gupnp-dlna-image-information.c
@@ -47,14 +47,14 @@
 
 #include "gupnp-dlna-image-information.h"
 
-G_DEFINE_ABSTRACT_TYPE (GUPnPDLNAImageInformation,
-                        gupnp_dlna_image_information,
-                        G_TYPE_OBJECT)
-
 struct _GUPnPDLNAImageInformationPrivate {
         gpointer placeholder;
 };
 
+G_DEFINE_ABSTRACT_TYPE_WITH_PRIVATE (GUPnPDLNAImageInformation,
+                                     gupnp_dlna_image_information,
+                                     G_TYPE_OBJECT)
+
 static void
 gupnp_dlna_image_information_class_init
                                     (GUPnPDLNAImageInformationClass *info_class)
@@ -63,18 +63,13 @@ gupnp_dlna_image_information_class_init
         info_class->get_height = NULL;
         info_class->get_width = NULL;
         info_class->get_mime = NULL;
-
-        g_type_class_add_private (info_class,
-                                  sizeof (GUPnPDLNAImageInformationPrivate));
 }
 
 static void
 gupnp_dlna_image_information_init (GUPnPDLNAImageInformation *info)
 {
-        GUPnPDLNAImageInformationPrivate *priv = G_TYPE_INSTANCE_GET_PRIVATE
-                                        (info,
-                                         GUPNP_TYPE_DLNA_IMAGE_INFORMATION,
-                                         GUPnPDLNAImageInformationPrivate);
+        GUPnPDLNAImageInformationPrivate *priv =
+            gupnp_dlna_image_information_get_instance_private (info);
 
         info->priv = priv;
 }
diff --git a/libgupnp-dlna/gupnp-dlna-information.c b/libgupnp-dlna/gupnp-dlna-information.c
index 37fb023..0334464 100644
--- a/libgupnp-dlna/gupnp-dlna-information.c
+++ b/libgupnp-dlna/gupnp-dlna-information.c
@@ -34,10 +34,6 @@
 
 #include "gupnp-dlna-information.h"
 
-G_DEFINE_ABSTRACT_TYPE (GUPnPDLNAInformation,
-                        gupnp_dlna_information,
-                        G_TYPE_OBJECT)
-
 struct _GUPnPDLNAInformationPrivate {
         gchar* uri;
         gboolean got_audio_info;
@@ -50,6 +46,10 @@ struct _GUPnPDLNAInformationPrivate {
         GUPnPDLNAVideoInformation *video_info;
 };
 
+G_DEFINE_ABSTRACT_TYPE_WITH_PRIVATE (GUPnPDLNAInformation,
+                                     gupnp_dlna_information,
+                                     G_TYPE_OBJECT)
+
 enum {
         PROP_0,
 
@@ -233,18 +233,13 @@ gupnp_dlna_information_class_init (GUPnPDLNAInformationClass *info_class)
                                      GUPNP_TYPE_DLNA_VIDEO_INFORMATION,
                                      G_PARAM_READABLE);
         g_object_class_install_property (object_class, PROP_VIDEO_INFO, pspec);
-
-        g_type_class_add_private (info_class,
-                                  sizeof (GUPnPDLNAInformationPrivate));
 }
 
 static void
 gupnp_dlna_information_init (GUPnPDLNAInformation *info)
 {
-        GUPnPDLNAInformationPrivate *priv = G_TYPE_INSTANCE_GET_PRIVATE
-                                        (info,
-                                         GUPNP_TYPE_DLNA_INFORMATION,
-                                         GUPnPDLNAInformationPrivate);
+        GUPnPDLNAInformationPrivate *priv =
+            gupnp_dlna_information_get_instance_private (info);
 
         priv->uri = NULL;
         priv->got_audio_info = FALSE;
diff --git a/libgupnp-dlna/gupnp-dlna-profile-guesser.c b/libgupnp-dlna/gupnp-dlna-profile-guesser.c
index 11fa355..757802b 100644
--- a/libgupnp-dlna/gupnp-dlna-profile-guesser.c
+++ b/libgupnp-dlna/gupnp-dlna-profile-guesser.c
@@ -43,15 +43,15 @@ enum {
 
 static guint signals[SIGNAL_LAST];
 
-G_DEFINE_TYPE (GUPnPDLNAProfileGuesser,
-               gupnp_dlna_profile_guesser,
-               G_TYPE_OBJECT)
-
 struct _GUPnPDLNAProfileGuesserPrivate {
         gboolean relaxed_mode;
         gboolean extended_mode;
 };
 
+G_DEFINE_TYPE_WITH_PRIVATE (GUPnPDLNAProfileGuesser,
+                            gupnp_dlna_profile_guesser,
+                            G_TYPE_OBJECT)
+
 enum {
         PROP_0,
         PROP_DLNA_RELAXED_MODE,
@@ -197,18 +197,13 @@ gupnp_dlna_profile_guesser_class_init
                                gupnp_dlna_profile_loader_get_from_disk (loader);
                 g_object_unref (loader);
         }
-
-        g_type_class_add_private (guesser_class,
-                                  sizeof (GUPnPDLNAProfileGuesserPrivate));
 }
 
 static void
 gupnp_dlna_profile_guesser_init (GUPnPDLNAProfileGuesser *self)
 {
-        GUPnPDLNAProfileGuesserPrivate *priv = G_TYPE_INSTANCE_GET_PRIVATE
-                                        (self,
-                                         GUPNP_TYPE_DLNA_PROFILE_GUESSER,
-                                         GUPnPDLNAProfileGuesserPrivate);
+        GUPnPDLNAProfileGuesserPrivate *priv =
+            gupnp_dlna_profile_guesser_get_instance_private (self);
 
         priv->relaxed_mode = FALSE;
         priv->extended_mode = FALSE;
diff --git a/libgupnp-dlna/gupnp-dlna-profile-loader.c b/libgupnp-dlna/gupnp-dlna-profile-loader.c
index 6c93cfb..f4d7a0f 100644
--- a/libgupnp-dlna/gupnp-dlna-profile-loader.c
+++ b/libgupnp-dlna/gupnp-dlna-profile-loader.c
@@ -34,7 +34,24 @@
 #include "gupnp-dlna-value-type.h"
 #include "gupnp-dlna-restriction-private.h"
 
-G_DEFINE_TYPE (GUPnPDLNAProfileLoader, gupnp_dlna_profile_loader, G_TYPE_OBJECT)
+struct _GUPnPDLNAProfileLoaderPrivate {
+        /* parser part */
+        GHashTable *restrictions;
+        GHashTable *profile_ids;
+        GHashTable *files_hash;
+        gboolean    relaxed_mode;
+        gboolean    extended_mode;
+        /* loader part */
+        GHashTable *descriptions;
+        GList      *tags_stack;
+        GList      *dlna_profile_data_stack;
+        GList      *restriction_data_stack;
+        char       *dlna_profile_dir;
+};
+
+G_DEFINE_TYPE_WITH_PRIVATE (GUPnPDLNAProfileLoader,
+                            gupnp_dlna_profile_loader,
+                            G_TYPE_OBJECT)
 
 #define DLNA_DATA_DIR DATA_DIR G_DIR_SEPARATOR_S "dlna-profiles"
 #define NODE_TYPE_ELEMENT_START 1
@@ -87,21 +104,6 @@ typedef struct {
         GUPnPDLNARestrictionType  type;
 } GUPnPDLNADescription;
 
-struct _GUPnPDLNAProfileLoaderPrivate {
-        /* parser part */
-        GHashTable *restrictions;
-        GHashTable *profile_ids;
-        GHashTable *files_hash;
-        gboolean    relaxed_mode;
-        gboolean    extended_mode;
-        /* loader part */
-        GHashTable *descriptions;
-        GList      *tags_stack;
-        GList      *dlna_profile_data_stack;
-        GList      *restriction_data_stack;
-        char       *dlna_profile_dir;
-};
-
 static GUPnPDLNANameValueListPair *
 gupnp_dlna_name_value_list_pair_new (const gchar        *name,
                                      GUPnPDLNAValueList *list)
@@ -856,18 +858,13 @@ gupnp_dlna_profile_loader_class_init (GUPnPDLNAProfileLoaderClass *loader_class)
         g_object_class_install_property (object_class,
                                          PROP_EXTENDED_MODE,
                                          spec);
-
-        g_type_class_add_private (loader_class,
-                                  sizeof (GUPnPDLNAProfileLoaderPrivate));
 }
 
 static void
 gupnp_dlna_profile_loader_init (GUPnPDLNAProfileLoader *self)
 {
-        GUPnPDLNAProfileLoaderPrivate *priv = G_TYPE_INSTANCE_GET_PRIVATE
-                                        (self,
-                                         GUPNP_TYPE_DLNA_PROFILE_LOADER,
-                                         GUPnPDLNAProfileLoaderPrivate);
+        GUPnPDLNAProfileLoaderPrivate *priv = 
+            gupnp_dlna_profile_loader_get_instance_private (self);
 
         priv->restrictions = g_hash_table_new_full (g_str_hash,
                                                     g_str_equal,
diff --git a/libgupnp-dlna/gupnp-dlna-profile.c b/libgupnp-dlna/gupnp-dlna-profile.c
index ac338ae..eb190a9 100644
--- a/libgupnp-dlna/gupnp-dlna-profile.c
+++ b/libgupnp-dlna/gupnp-dlna-profile.c
@@ -36,7 +36,6 @@
  * Public representation of the various audio/container/image/video
  * restrictions specified for that DLNA profile is to be added.
  */
-G_DEFINE_TYPE (GUPnPDLNAProfile, gupnp_dlna_profile, G_TYPE_OBJECT)
 
 struct _GUPnPDLNAProfilePrivate {
         gchar    *name;
@@ -48,6 +47,8 @@ struct _GUPnPDLNAProfilePrivate {
         GList    *video_restrictions;
 };
 
+G_DEFINE_TYPE_WITH_PRIVATE (GUPnPDLNAProfile, gupnp_dlna_profile, G_TYPE_OBJECT)
+
 enum {
         PROP_0,
         PROP_DLNA_NAME,
@@ -265,16 +266,13 @@ gupnp_dlna_profile_class_init (GUPnPDLNAProfileClass *klass)
         g_object_class_install_property (object_class,
                                          PROP_VIDEO_RESTRICTIONS,
                                          pspec);
-
-        g_type_class_add_private (klass, sizeof (GUPnPDLNAProfilePrivate));
 }
 
 static void
 gupnp_dlna_profile_init (GUPnPDLNAProfile *profile)
 {
-        GUPnPDLNAProfilePrivate *priv = G_TYPE_INSTANCE_GET_PRIVATE (profile,
-                                                  GUPNP_TYPE_DLNA_PROFILE,
-                                                  GUPnPDLNAProfilePrivate);
+        GUPnPDLNAProfilePrivate *priv =
+            gupnp_dlna_profile_get_instance_private (profile);
 
         priv->name = NULL;
         priv->mime = NULL;
diff --git a/libgupnp-dlna/gupnp-dlna-video-information.c b/libgupnp-dlna/gupnp-dlna-video-information.c
index e1d6c06..6a0df92 100644
--- a/libgupnp-dlna/gupnp-dlna-video-information.c
+++ b/libgupnp-dlna/gupnp-dlna-video-information.c
@@ -48,14 +48,14 @@
 
 #include "gupnp-dlna-video-information.h"
 
-G_DEFINE_ABSTRACT_TYPE (GUPnPDLNAVideoInformation,
-                        gupnp_dlna_video_information,
-                        G_TYPE_OBJECT)
-
 struct _GUPnPDLNAVideoInformationPrivate {
         gpointer placeholder;
 };
 
+G_DEFINE_ABSTRACT_TYPE_WITH_PRIVATE (GUPnPDLNAVideoInformation,
+                                     gupnp_dlna_video_information,
+                                     G_TYPE_OBJECT)
+
 static void
 gupnp_dlna_video_information_class_init
                                     (GUPnPDLNAVideoInformationClass *info_class)
@@ -71,18 +71,13 @@ gupnp_dlna_video_information_class_init
         info_class->is_system_stream = NULL;
         info_class->get_width = NULL;
         info_class->get_mime = NULL;
-
-        g_type_class_add_private (info_class,
-                                  sizeof (GUPnPDLNAVideoInformationPrivate));
 }
 
 static void
 gupnp_dlna_video_information_init (GUPnPDLNAVideoInformation *info)
 {
-        GUPnPDLNAVideoInformationPrivate *priv = G_TYPE_INSTANCE_GET_PRIVATE
-                                        (info,
-                                         GUPNP_TYPE_DLNA_VIDEO_INFORMATION,
-                                         GUPnPDLNAVideoInformationPrivate);
+        GUPnPDLNAVideoInformationPrivate *priv =
+            gupnp_dlna_video_information_get_instance_private (info);
 
         info->priv = priv;
 }
diff --git a/libgupnp-dlna/metadata-backends/gstreamer/gupnp-dlna-gst-audio-information.c b/libgupnp-dlna/metadata-backends/gstreamer/gupnp-dlna-gst-audio-information.c
index 8d21b41..0f8a5a0 100644
--- a/libgupnp-dlna/metadata-backends/gstreamer/gupnp-dlna-gst-audio-information.c
+++ b/libgupnp-dlna/metadata-backends/gstreamer/gupnp-dlna-gst-audio-information.c
@@ -25,10 +25,6 @@
 #include "gupnp-dlna-gst-audio-information.h"
 #include "gupnp-dlna-gst-info-utils.h"
 
-G_DEFINE_TYPE (GUPnPDLNAGstAudioInformation,
-               gupnp_dlna_gst_audio_information,
-               GUPNP_TYPE_DLNA_AUDIO_INFORMATION)
-
 struct _GUPnPDLNAGstAudioInformationPrivate {
         GstDiscovererInfo *info;
         GList *stream_list;
@@ -36,6 +32,10 @@ struct _GUPnPDLNAGstAudioInformationPrivate {
         GstCaps *caps;
 };
 
+G_DEFINE_TYPE_WITH_PRIVATE (GUPnPDLNAGstAudioInformation,
+                            gupnp_dlna_gst_audio_information,
+                            GUPNP_TYPE_DLNA_AUDIO_INFORMATION)
+
 enum
 {
         PROP_0,
@@ -377,18 +377,13 @@ gupnp_dlna_gst_audio_information_class_init
         g_object_class_install_property (object_class,
                                          PROP_INFO,
                                          pspec);
-
-        g_type_class_add_private (gst_info_class,
-                                  sizeof (GUPnPDLNAGstAudioInformationPrivate));
 }
 
 static void
 gupnp_dlna_gst_audio_information_init (GUPnPDLNAGstAudioInformation *self)
 {
-        GUPnPDLNAGstAudioInformationPrivate *priv = G_TYPE_INSTANCE_GET_PRIVATE
-                                        (self,
-                                         GUPNP_TYPE_DLNA_GST_AUDIO_INFORMATION,
-                                         GUPnPDLNAGstAudioInformationPrivate);
+        GUPnPDLNAGstAudioInformationPrivate *priv =
+            gupnp_dlna_gst_audio_information_get_instance_private (self);
 
         priv->info = NULL;
         priv->stream_list = NULL;
diff --git a/libgupnp-dlna/metadata/gupnp-dlna-metadata-extractor.c b/libgupnp-dlna/metadata/gupnp-dlna-metadata-extractor.c
index 3ae248f..2ddc6df 100644
--- a/libgupnp-dlna/metadata/gupnp-dlna-metadata-extractor.c
+++ b/libgupnp-dlna/metadata/gupnp-dlna-metadata-extractor.c
@@ -65,14 +65,14 @@ enum {
 
 static guint signals[SIGNAL_LAST];
 
-G_DEFINE_ABSTRACT_TYPE (GUPnPDLNAMetadataExtractor,
-                        gupnp_dlna_metadata_extractor,
-                        G_TYPE_OBJECT)
-
 struct _GUPnPDLNAMetadataExtractorPrivate {
         gpointer placeholder;
 };
 
+G_DEFINE_ABSTRACT_TYPE_WITH_PRIVATE (GUPnPDLNAMetadataExtractor,
+                                     gupnp_dlna_metadata_extractor,
+                                     G_TYPE_OBJECT)
+
 static void
 gupnp_dlna_metadata_extractor_class_init
                               (GUPnPDLNAMetadataExtractorClass *extractor_class)
@@ -102,18 +102,13 @@ gupnp_dlna_metadata_extractor_class_init
                               2,
                               GUPNP_TYPE_DLNA_INFORMATION,
                               G_TYPE_ERROR);
-
-        g_type_class_add_private (extractor_class,
-                                  sizeof (GUPnPDLNAMetadataExtractorPrivate));
 }
 
 static void
 gupnp_dlna_metadata_extractor_init (GUPnPDLNAMetadataExtractor *self)
 {
         GUPnPDLNAMetadataExtractorPrivate *priv =
-                G_TYPE_INSTANCE_GET_PRIVATE (self,
-                                             GUPNP_TYPE_DLNA_METADATA_EXTRACTOR,
-                                             GUPnPDLNAMetadataExtractorPrivate);
+            gupnp_dlna_metadata_extractor_get_instance_private (self);
 
         self->priv = priv;
 }
-- 
2.18.1

